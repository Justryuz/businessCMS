/*!
 * Stellar.js v0.6.2
 * http://markdalgleish.com/projects/stellar.js
 * 
 * Copyright 2013, Mark Dalgleish
 * This content is released under the MIT license
 * http://markdalgleish.mit-license.org
 */
;(function(y,t,r,A){var u="stellar",z={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:true,verticalScrolling:true,horizontalOffset:0,verticalOffset:0,responsive:false,parallaxBackgrounds:true,parallaxElements:true,hideDistantElements:true,hideElement:function(a){a.hide()},showElement:function(a){a.show()}},x={scroll:{getLeft:function(a){return a.scrollLeft()},setLeft:function(b,a){b.scrollLeft(a)},getTop:function(a){return a.scrollTop()},setTop:function(b,a){b.scrollTop(a)}},position:{getLeft:function(a){return parseInt(a.css("left"),10)*-1},getTop:function(a){return parseInt(a.css("top"),10)*-1}},margin:{getLeft:function(a){return parseInt(a.css("margin-left"),10)*-1},getTop:function(a){return parseInt(a.css("margin-top"),10)*-1}},transform:{getLeft:function(a){var b=getComputedStyle(a[0])[v];return(b!=="none"?parseInt(b.match(/(-?[0-9]+)/g)[4],10)*-1:0)},getTop:function(a){var b=getComputedStyle(a[0])[v];return(b!=="none"?parseInt(b.match(/(-?[0-9]+)/g)[5],10)*-1:0)}}},s={position:{setLeft:function(b,a){b.css("left",a)},setTop:function(b,a){b.css("top",a)}},transform:{setPosition:function(c,a,d,b,e){c[0].style[v]="translate3d("+(a-d)+"px, "+(b-e)+"px, 0)"}}},D=(function(){var b=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,d=y("script")[0].style,c="",a;for(a in d){if(b.test(a)){c=a.match(b)[0];break}}if("WebkitOpacity" in d){c="Webkit"}if("KhtmlOpacity" in d){c="Khtml"}return function(e){return c+(c.length>0?e.charAt(0).toUpperCase()+e.slice(1):e)}}()),v=D("transform"),B=y("<div />",{style:"background:#fff"}).css("background-position-x")!==A,C=(B?function(b,c,a){b.css({"background-position-x":c,"background-position-y":a})}:function(b,c,a){b.css("background-position",c+" "+a)}),w=(B?function(a){return[a.css("background-position-x"),a.css("background-position-y")]}:function(a){return a.css("background-position").split(" ")}),q=(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(a){setTimeout(a,1000/60)});function p(a,b){this.element=a;this.options=y.extend({},z,b);this._defaults=z;this._name=u;this.init()}p.prototype={init:function(){this.options.name=u+"_"+Math.floor(Math.random()*1000000000);this._defineElements();this._defineGetters();this._defineSetters();this._handleWindowLoadAndResize();this._detectViewport();this.refresh({firstLoad:true});if(this.options.scrollProperty==="scroll"){this._handleScrollEvent()}else{this._startAnimationLoop()}},_defineElements:function(){if(this.element===r.body){this.element=t}this.$scrollElement=y(this.element);this.$element=(this.element===t?y("body"):this.$scrollElement);this.$viewportElement=(this.options.viewportElement!==A?y(this.options.viewportElement):(this.$scrollElement[0]===t||this.options.scrollProperty==="scroll"?this.$scrollElement:this.$scrollElement.parent()))},_defineGetters:function(){var b=this,a=x[b.options.scrollProperty];this._getScrollLeft=function(){return a.getLeft(b.$scrollElement)};this._getScrollTop=function(){return a.getTop(b.$scrollElement)}},_defineSetters:function(){var e=this,b=x[e.options.scrollProperty],d=s[e.options.positionProperty],c=b.setLeft,a=b.setTop;this._setScrollLeft=(typeof c==="function"?function(f){c(e.$scrollElement,f)}:y.noop);this._setScrollTop=(typeof a==="function"?function(f){a(e.$scrollElement,f)}:y.noop);this._setPosition=d.setPosition||function(g,j,h,f,i){if(e.options.horizontalScrolling){d.setLeft(g,j,h)}if(e.options.verticalScrolling){d.setTop(g,f,i)}}},_handleWindowLoadAndResize:function(){var b=this,a=y(t);if(b.options.responsive){a.bind("load."+this.name,function(){b.refresh()})}a.bind("resize."+this.name,function(){b._detectViewport();if(b.options.responsive){b.refresh()}})},refresh:function(b){var c=this,a=c._getScrollLeft(),d=c._getScrollTop();if(!b||!b.firstLoad){this._reset()}this._setScrollLeft(0);this._setScrollTop(0);this._setOffsets();this._findParticles();this._findBackgrounds();if(b&&b.firstLoad&&/WebKit/.test(navigator.userAgent)){y(t).load(function(){var e=c._getScrollLeft(),f=c._getScrollTop();c._setScrollLeft(e+1);c._setScrollTop(f+1);c._setScrollLeft(e);c._setScrollTop(f)})}this._setScrollLeft(a);this._setScrollTop(d)},_detectViewport:function(){var a=this.$viewportElement.offset(),b=a!==null&&a!==A;this.viewportWidth=this.$viewportElement.width();this.viewportHeight=this.$viewportElement.height();this.viewportOffsetTop=(b?a.top:0);this.viewportOffsetLeft=(b?a.left:0)},_findParticles:function(){var d=this,a=this._getScrollLeft(),b=this._getScrollTop();if(this.particles!==A){for(var c=this.particles.length-1;c>=0;c--){this.particles[c].$element.data("stellar-elementIsActive",A)}}this.particles=[];if(!this.options.parallaxElements){return}this.$element.find("[data-stellar-ratio]").each(function(h){var L=y(this),f,n,I,e,i,K,o,j,l,g=0,J=0,m=0,k=0;if(!L.data("stellar-elementIsActive")){L.data("stellar-elementIsActive",this)}else{if(L.data("stellar-elementIsActive")!==this){return}}d.options.showElement(L);if(!L.data("stellar-startingLeft")){L.data("stellar-startingLeft",L.css("left"));L.data("stellar-startingTop",L.css("top"))}else{L.css("left",L.data("stellar-startingLeft"));L.css("top",L.data("stellar-startingTop"))}I=L.position().left;e=L.position().top;i=(L.css("margin-left")==="auto")?0:parseInt(L.css("margin-left"),10);K=(L.css("margin-top")==="auto")?0:parseInt(L.css("margin-top"),10);j=L.offset().left-i;l=L.offset().top-K;L.parents().each(function(){var E=y(this);if(E.data("stellar-offset-parent")===true){g=m;J=k;o=E;return false}else{m+=E.position().left;k+=E.position().top}});f=(L.data("stellar-horizontal-offset")!==A?L.data("stellar-horizontal-offset"):(o!==A&&o.data("stellar-horizontal-offset")!==A?o.data("stellar-horizontal-offset"):d.horizontalOffset));n=(L.data("stellar-vertical-offset")!==A?L.data("stellar-vertical-offset"):(o!==A&&o.data("stellar-vertical-offset")!==A?o.data("stellar-vertical-offset"):d.verticalOffset));d.particles.push({$element:L,$offsetParent:o,isFixed:L.css("position")==="fixed",horizontalOffset:f,verticalOffset:n,startingPositionLeft:I,startingPositionTop:e,startingOffsetLeft:j,startingOffsetTop:l,parentOffsetLeft:g,parentOffsetTop:J,stellarRatio:(L.data("stellar-ratio")!==A?L.data("stellar-ratio"):1),width:L.outerWidth(true),height:L.outerHeight(true),isHidden:false})})},_findBackgrounds:function(){var d=this,a=this._getScrollLeft(),b=this._getScrollTop(),c;this.backgrounds=[];if(!this.options.parallaxBackgrounds){return}c=this.$element.find("[data-stellar-background-ratio]");if(this.$element.data("stellar-background-ratio")){c=c.add(this.$element)}c.each(function(){var L=y(this),I=w(L),f,m,n,e,h,K,i,k,o,g=0,J=0,l=0,j=0;if(!L.data("stellar-backgroundIsActive")){L.data("stellar-backgroundIsActive",this)}else{if(L.data("stellar-backgroundIsActive")!==this){return}}if(!L.data("stellar-backgroundStartingLeft")){L.data("stellar-backgroundStartingLeft",I[0]);L.data("stellar-backgroundStartingTop",I[1])}else{C(L,L.data("stellar-backgroundStartingLeft"),L.data("stellar-backgroundStartingTop"))}h=(L.css("margin-left")==="auto")?0:parseInt(L.css("margin-left"),10);K=(L.css("margin-top")==="auto")?0:parseInt(L.css("margin-top"),10);i=L.offset().left-h-a;k=L.offset().top-K-b;L.parents().each(function(){var E=y(this);if(E.data("stellar-offset-parent")===true){g=l;J=j;o=E;return false}else{l+=E.position().left;j+=E.position().top}});f=(L.data("stellar-horizontal-offset")!==A?L.data("stellar-horizontal-offset"):(o!==A&&o.data("stellar-horizontal-offset")!==A?o.data("stellar-horizontal-offset"):d.horizontalOffset));m=(L.data("stellar-vertical-offset")!==A?L.data("stellar-vertical-offset"):(o!==A&&o.data("stellar-vertical-offset")!==A?o.data("stellar-vertical-offset"):d.verticalOffset));d.backgrounds.push({$element:L,$offsetParent:o,isFixed:L.css("background-attachment")==="fixed",horizontalOffset:f,verticalOffset:m,startingValueLeft:I[0],startingValueTop:I[1],startingBackgroundPositionLeft:(isNaN(parseInt(I[0],10))?0:parseInt(I[0],10)),startingBackgroundPositionTop:(isNaN(parseInt(I[1],10))?0:parseInt(I[1],10)),startingPositionLeft:L.position().left,startingPositionTop:L.position().top,startingOffsetLeft:i,startingOffsetTop:k,parentOffsetLeft:g,parentOffsetTop:J,stellarRatio:(L.data("stellar-background-ratio")===A?1:L.data("stellar-background-ratio"))})})},_reset:function(){var a,b,c,d,e;for(e=this.particles.length-1;e>=0;e--){a=this.particles[e];b=a.$element.data("stellar-startingLeft");c=a.$element.data("stellar-startingTop");this._setPosition(a.$element,b,b,c,c);this.options.showElement(a.$element);a.$element.data("stellar-startingLeft",null).data("stellar-elementIsActive",null).data("stellar-backgroundIsActive",null)}for(e=this.backgrounds.length-1;e>=0;e--){d=this.backgrounds[e];d.$element.data("stellar-backgroundStartingLeft",null).data("stellar-backgroundStartingTop",null);C(d.$element,d.startingValueLeft,d.startingValueTop)}},destroy:function(){this._reset();this.$scrollElement.unbind("resize."+this.name).unbind("scroll."+this.name);this._animationLoop=y.noop;y(t).unbind("load."+this.name).unbind("resize."+this.name)},_setOffsets:function(){var b=this,a=y(t);a.unbind("resize.horizontal-"+this.name).unbind("resize.vertical-"+this.name);if(typeof this.options.horizontalOffset==="function"){this.horizontalOffset=this.options.horizontalOffset();a.bind("resize.horizontal-"+this.name,function(){b.horizontalOffset=b.options.horizontalOffset()})}else{this.horizontalOffset=this.options.horizontalOffset}if(typeof this.options.verticalOffset==="function"){this.verticalOffset=this.options.verticalOffset();a.bind("resize.vertical-"+this.name,function(){b.verticalOffset=b.options.verticalOffset()})}else{this.verticalOffset=this.options.verticalOffset}},_repositionElements:function(){var l=this._getScrollLeft(),F=this._getScrollTop(),g,o,h,b,d,c,k,m=true,f=true,i,e,n,a,j;if(this.currentScrollLeft===l&&this.currentScrollTop===F&&this.currentWidth===this.viewportWidth&&this.currentHeight===this.viewportHeight){return}else{this.currentScrollLeft=l;this.currentScrollTop=F;this.currentWidth=this.viewportWidth;this.currentHeight=this.viewportHeight}for(j=this.particles.length-1;j>=0;j--){h=this.particles[j];b=(h.isFixed?1:0);if(this.options.horizontalScrolling){i=(l+h.horizontalOffset+this.viewportOffsetLeft+h.startingPositionLeft-h.startingOffsetLeft+h.parentOffsetLeft)*-(h.stellarRatio+b-1)+h.startingPositionLeft;n=i-h.startingPositionLeft+h.startingOffsetLeft}else{i=h.startingPositionLeft;n=h.startingOffsetLeft}if(this.options.verticalScrolling){e=(F+h.verticalOffset+this.viewportOffsetTop+h.startingPositionTop-h.startingOffsetTop+h.parentOffsetTop)*-(h.stellarRatio+b-1)+h.startingPositionTop;a=e-h.startingPositionTop+h.startingOffsetTop}else{e=h.startingPositionTop;a=h.startingOffsetTop}if(this.options.hideDistantElements){f=!this.options.horizontalScrolling||n+h.width>(h.isFixed?0:l)&&n<(h.isFixed?0:l)+this.viewportWidth+this.viewportOffsetLeft;m=!this.options.verticalScrolling||a+h.height>(h.isFixed?0:F)&&a<(h.isFixed?0:F)+this.viewportHeight+this.viewportOffsetTop}if(f&&m){if(h.isHidden){this.options.showElement(h.$element);h.isHidden=false}this._setPosition(h.$element,i,h.startingPositionLeft,e,h.startingPositionTop)}else{if(!h.isHidden){this.options.hideElement(h.$element);h.isHidden=true}}}for(j=this.backgrounds.length-1;j>=0;j--){d=this.backgrounds[j];b=(d.isFixed?0:1);c=(this.options.horizontalScrolling?(l+d.horizontalOffset-this.viewportOffsetLeft-d.startingOffsetLeft+d.parentOffsetLeft-d.startingBackgroundPositionLeft)*(b-d.stellarRatio)+"px":d.startingValueLeft);k=(this.options.verticalScrolling?(F+d.verticalOffset-this.viewportOffsetTop-d.startingOffsetTop+d.parentOffsetTop-d.startingBackgroundPositionTop)*(b-d.stellarRatio)+"px":d.startingValueTop);C(d.$element,c,k)}},_handleScrollEvent:function(){var c=this,b=false;var a=function(){c._repositionElements();b=false};var d=function(){if(!b){q(a);b=true}};this.$scrollElement.bind("scroll."+this.name,d);d()},_startAnimationLoop:function(){var a=this;this._animationLoop=function(){q(a._animationLoop);a._repositionElements()};this._animationLoop()}};y.fn[u]=function(a){var b=arguments;if(a===A||typeof a==="object"){return this.each(function(){if(!y.data(this,"plugin_"+u)){y.data(this,"plugin_"+u,new p(this,a))}})}else{if(typeof a==="string"&&a[0]!=="_"&&a!=="init"){return this.each(function(){var c=y.data(this,"plugin_"+u);if(c instanceof p&&typeof c[a]==="function"){c[a].apply(c,Array.prototype.slice.call(b,1))}if(a==="destroy"){y.data(this,"plugin_"+u,null)}})}}};y[u]=function(b){var a=y(t);return a.stellar.apply(a,Array.prototype.slice.call(arguments,0))};y[u].scrollProperty=x;y[u].positionProperty=s;t.Stellar=p}(jQuery,this,document));